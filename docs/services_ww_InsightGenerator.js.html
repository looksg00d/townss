<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/ww_InsightGenerator.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/ww_InsightGenerator.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// services/InsightGenerator.js
const AlphaServiceError = require('../errors/AlphaServiceError');
const logger = require('./logger').withLabel('InsightGenerator');

class InsightGenerator {
  constructor({ openai, model }) {
    this.openai = openai;
    this.logger = logger;
    this.model = model || "mixtral-8x7b-32768";
    this.cryptoINSIDER = require('../characters/cryptoINSIDER.json');
  }


  /**
   * Генерирует Alpha Insight на основе поста.
   * @param {Object} post - Пост для анализа.
   * @returns {Promise&lt;string>} - Сгенерированный контент.
   */
  async generate(post) {
    try {
      this.logger.info('\n=== Post Analysis ===');
      this.logger.debug(`Using model: ${this.model}`);

      // Добавляем задержку в 5 секунд перед запросом к API
      this.logger.info('Waiting 5 seconds before API request...');
      await new Promise(resolve => setTimeout(resolve, 5000));

      const fullPrompt = `
${JSON.stringify(this.cryptoINSIDER, null, 2)}

Additional rules:
- Write in English only
- Start directly with the main information
- No introductory phrases like "It looks like" or "I see that"
- Be concise and direct
- Keep it short (max 5-7 sentences)

Remember: You're chatting with friends, not writing a report!`;

      const response = await this.openai.chat.completions.create({
        model: this.model,
        messages: [
          { role: "system", content: fullPrompt },
          { role: "user", content: post.content },
        ],
        temperature: 0.7,
        max_tokens: 500,
      });

      if (!response.choices || !response.choices[0]) {
        throw new Error('Invalid API response structure');
      }

      return response.choices[0].message.content;
    } catch (error) {
      this.logger.error('Response generation error:', error);
      throw new AlphaServiceError('Ошибка при генерации инсайта');
    }
  }
}

module.exports = InsightGenerator;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DataFetchService.html">DataFetchService</a></li><li><a href="ProfileService.html">ProfileService</a></li><li><a href="ResponseGeneratorService.html">ResponseGeneratorService</a></li></ul><h3>Global</h3><ul><li><a href="global.html#collectAllData">collectAllData</a></li><li><a href="global.html#collectCryptoChatAlphaInsights">collectCryptoChatAlphaInsights</a></li><li><a href="global.html#collectCryptoChatPosts">collectCryptoChatPosts</a></li><li><a href="global.html#collectTownsCharacters">collectTownsCharacters</a></li><li><a href="global.html#runDiscussion">runDiscussion</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Feb 15 2025 23:41:24 GMT+0300 (Moscow Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
