<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/JSON_SERVICE.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/JSON_SERVICE.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const fs = require('fs').promises;
const path = require('path');

/**
 * Собирает объекты персонажей из каталога towns/characters.
 * Возвращает массив с содержимым всех .json файлов.
 */
async function collectTownsCharacters() {
  const charactersDir = path.join(__dirname, '../characters');
  let result = [];
  try {
    const files = await fs.readdir(charactersDir);
    for (const file of files) {
      if (file.endsWith('.json')) {
        const filePath = path.join(charactersDir, file);
        const content = await fs.readFile(filePath, 'utf8');
        try {
          const json = JSON.parse(content);
          result.push(json);
        } catch (err) {
          console.error(`Ошибка парсинга файла ${filePath}: ${err.message}`);
        }
      }
    }
  } catch (err) {
    console.error(`Ошибка чтения директории ${charactersDir}: ${err.message}`);
  }
  return result;
}

/**
 * Собирает инсайты из файлов JSON каталога crypto-chat/data/alpha_insights.
 * Каждый файл должен содержать JSON (например, строку или объект).
 * Возвращает массив объектов вида { id, insight }.
 */
async function collectCryptoChatAlphaInsights() {
  const insightsDir = path.join(__dirname, '../crypto-chat/data/alpha_insights');
  let insights = [];
  try {
    const files = await fs.readdir(insightsDir);
    for (const file of files) {
      if (file.endsWith('.json')) {
        const filePath = path.join(insightsDir, file);
        const content = await fs.readFile(filePath, 'utf8');
        let data;
        try {
          data = JSON.parse(content);
        } catch (e) {
          console.error(`Ошибка парсинга файла ${filePath}: ${e.message}`);
          // Если произошла ошибка парсинга, сохраняем как строку
          data = content;
        }
        insights.push({
          id: path.basename(file, '.json'),
          insight: data
        });
      }
    }
  } catch (err) {
    console.error(`Ошибка чтения директории ${insightsDir}: ${err.message}`);
  }
  return insights;
}

/**
 * Собирает посты из каталога crypto-chat/data/posts.
 * Предполагается, что для каждого поста существует своя директория (название – id поста)
 * с файлами meta.json и content.md.
 * Возвращает массив объектов вида { id, meta, content }.
 */
async function collectCryptoChatPosts() {
  const postsBaseDir = path.join(__dirname, '../crypto-chat/data/posts');
  let posts = [];
  try {
    const dirs = await fs.readdir(postsBaseDir, { withFileTypes: true });
    for (const dirent of dirs) {
      if (dirent.isDirectory()) {
        const postId = dirent.name;
        const postDir = path.join(postsBaseDir, postId);
        const metaPath = path.join(postDir, 'meta.json');
        const contentPath = path.join(postDir, 'content.md');
        try {
          const metaContent = await fs.readFile(metaPath, 'utf8');
          const meta = JSON.parse(metaContent);
          const content = await fs.readFile(contentPath, 'utf8');
          posts.push({ id: postId, meta, content });
        } catch (err) {
          console.error(`Ошибка чтения поста ${postId}: ${err.message}`);
        }
      }
    }
  } catch (err) {
    console.error(`Ошибка чтения директории ${postsBaseDir}: ${err.message}`);
  }
  return posts;
}

/**
 * Собирает все данные в один объект.
 * Особенности: 
 * - townsCharacters: данные персонажей из каталога towns/characters.
 * - cryptoChatAlphaInsights: инсайты из каталога crypto-chat/data/alpha_insights.
 * - cryptoChatPosts: посты из каталога crypto-chat/data/posts.
 */
async function collectAllData() {
  const [townsCharacters, cryptoChatAlphaInsights, cryptoChatPosts] = await Promise.all([
    collectTownsCharacters(),
    collectCryptoChatAlphaInsights(),
    collectCryptoChatPosts()
  ]);

  return {
    townsCharacters,
    cryptoChatAlphaInsights,
    cryptoChatPosts
  };
}

module.exports = {
  collectTownsCharacters,
  collectCryptoChatAlphaInsights,
  collectCryptoChatPosts,
  collectAllData
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DataFetchService.html">DataFetchService</a></li><li><a href="ProfileService.html">ProfileService</a></li><li><a href="ResponseGeneratorService.html">ResponseGeneratorService</a></li></ul><h3>Global</h3><ul><li><a href="global.html#collectAllData">collectAllData</a></li><li><a href="global.html#collectCryptoChatAlphaInsights">collectCryptoChatAlphaInsights</a></li><li><a href="global.html#collectCryptoChatPosts">collectCryptoChatPosts</a></li><li><a href="global.html#collectTownsCharacters">collectTownsCharacters</a></li><li><a href="global.html#runDiscussion">runDiscussion</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Feb 15 2025 23:41:24 GMT+0300 (Moscow Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
